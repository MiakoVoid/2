---
trigger: always_on
---

# 绿芽记账 - 基于AI智能识别的个人财务管理应用

## 项目概述

绿芽记账是一款基于AI智能识别的个人财务管理应用，通过创新的技术架构和优雅的用户体验，为用户提供便捷高效的财务管理服务。项目采用云端AI技术实现智能消费分类和分析，结合简洁直观的移动端界面，帮助用户轻松管理个人财务。
任何地方不使用Toast
### 技术架构
- 前端：Android Native (Java) + Material Design 3 + MVVM架构
- 后端：Spring Boot 2.7 + MyBatis-Plus 3.5 + MySQL
- AI服务：魔塔社区 Qwen2.5-7B-Instruct 模型
- OCR引擎：Google ML Kit Text Recognition
- 部署平台：Render

## UI/UX设计规范

### 视觉风格
采用低饱和绿色系设计语言，营造清新自然的视觉体验：
- 主色调：#6D947C（沉稳绿色）
- 次要色：#90B09C（柔和绿色）
- 强调色：#4A6E59（深绿色）
- 收入色：#5A926B（成功绿）
- 支出色：#D4BEB0（协调的暖棕色）
- 背景色：#F2F7F3（浅绿背景）
- 文字色：#3A4A40（深灰绿）

### 设计原则
- 遵循Material Design 3设计语言
- 采用卡片式布局，确保充足留白
- 统一使用8dp/16dp圆角设计
- 提供微交互反馈，增强用户体验
- 保持设计元素的一致性

## 系统架构设计

### 安卓前端架构
应用采用模块化架构设计，分为四个主要层次：

**界面层**
- 认证模块：处理用户登录注册
- 首页模块：展示财务概览和核心功能
- 账单管理：处理账单的增删改查
- 日历视图：按时间维度展示消费记录
- 报表分析：提供数据可视化分析
- 个人中心：用户设置和数据管理

**数据层**
- 数据模型：定义业务数据结构
- 数据仓库：统一数据访问接口
- 本地数据库：离线数据存储

**领域层**
- 业务用例：封装核心业务逻辑
- 仓库接口：定义数据访问契约

**公共组件**
- 通用UI组件：可复用的界面元素
- 工具类库：通用功能方法
- 主题配置：统一的设计系统

### 核心功能页面

**登录页面**
采用居中卡片式布局，提供注册入口和记住密码功能。

**首页**
包含顶部导航栏、财务概览卡片、预算管理模块和所有账单列表。财务概览展示今日支出、本月支出、本月收入、剩余预算。

**预算管理页面**
- 支持设置月度预算金额
- 增加、编辑和删除预算项
- 显示预算项列表
- 从首页预算管理入口进入
-预计支出项到期未确认时,自动删除;预计支出项被确认后,自动从预计支出列表删除，并添加到正式账单列表中。

**底部导航栏设计**
- 首页图标：展示财务概览和核心数据
- 日历图标：跳转日历页面
- 中央悬浮按钮：快捷记账入口
- 报表图标：跳转报表分析页面
- 个人中心图标：跳转个人设置页面

**账单详情页面**
展示账单详细信息，包括金额、分类、时间、商户、备注等基本信息，支持编辑、删除和退款操作。
点击退款按钮弹出退款金额输入框，支持输入退款金额，自动计算最终金额。

**添加账单页面**
提供三种记账方式：手动选择记账、截图记账、文本记账。支持以下功能：
- 手动记账时可增加分类。
- 收支类型选择（支出/收入）
- 时间选择（精确到分钟）
- 两级分类选择（主分类-子分类）
- 商户名称输入
- 备注信息（可选）
- 金额管理：原始金额、退款金额、最终金额自动计算

**智能记账确认页面**
- 展示AI识别结果的预览
- 允许用户修改所有识别字段
- 仅在用户手动修改分类时触发自动创建分类
- 提供一键确认保存功能

**日历页面**
展示月度日历视图，标记每日消费情况，支持日期选择和当日账单明细查看，可以快速定位到今日。左上角显示月份、收入、支出、结余。

**报表页面**
提供多维度财务分析，包括支出趋势图、构成分析、分类排行和AI财务建议。

**个人中心页面**
展示用户信息、数据统计和功能入口，包括分类管理、分类关键词管理、数据迁移、导入导出等功能。

## 后端服务设计

## 核心功能特性

### 三种记账方式

**1. 手动选择记账**
- 传统表单式记账
- 支持收支类型选择、时间选择、两级分类选择
- 支持原始金额和退款金额输入
- 自动计算最终金额
- 提供最近使用分类快速选择
- **分类自动创建**：用户输入新分类时自动创建

**2. 截图记账**
- 支持两种截图获取方式：
    - 系统截图监听自动触发
    - 手动上传图片识别
- 智能识别支付渠道：微信、支付宝、美团、银行卡、淘宝、京东等
- 两级分类解析：主分类（餐饮）、子分类（快餐）
- 自动提取商户信息和商品明细
- **识别结果确认**：展示识别结果供用户确认和修改
- **条件性分类创建**：仅在用户手动修改分类时自动创建

**3. 文本记账**
- 自然语言文本输入记账
- 智能解析金额、分类、时间、商户信息
- 文本输入框实时解析
- **解析结果确认**：展示解析结果供用户确认和修改
- **条件性分类创建**：仅在用户手动修改分类时自动创建

### 智能记账确认流程
```
AI识别/解析 → 结果预览页面 → 用户确认/修改 → 保存账单
            ↓
  用户修改分类？ → 分类不存在？ → 自动创建分类 → 继续流程
```

### 条件性分类自动创建规则
- **AI识别时**：仅使用分类库中存在的分类，不自动创建新分类
- **用户手动修改时**：当用户修改AI推荐分类为新分类时自动创建
- **手动记账时**：当用户输入新分类时自动创建
- **分类库保护**：防止AI随意创建无效分类，保持分类库的整洁性

### 两级分类体系
- **主分类**：餐饮、交通、购物、娱乐、医疗、教育、生活、其他
- **子分类**：在主分类下的具体细分
- 示例：餐饮（主分类）→ 快餐、奶茶、正餐、零食（子分类）

### 退款金额管理功能
- 支持原始金额和退款金额分别记录
- 自动计算最终金额：最终金额 = 原始金额 - 退款金额
- 显示优化：有退款时显示"最终金额（划掉原始金额）"
- 退款金额默认为0，可选填写

### 底部导航与快捷记账

**底部导航栏布局**
```
[首页] [日历] [+] [报表] [我的]
```

**中央悬浮按钮功能**
- 悬浮在底部导航栏上方
- 圆形设计，突出显示
- 点击弹出快速记账选择菜单
- 提供三种记账方式的快速入口

**快捷记账流程**
1. 点击中央悬浮按钮
2. 弹出记账方式选择菜单
3. 选择记账方式（手动/截图/文本）
4. 跳转到对应记账界面
5. 完成记账后返回首页

### 智能分类系统
基于关键词匹配和Qwen2.5-7B模型实现消费记录的智能分类，支持两级分类体系。系统通过优化提示词模板和上下文学习，提升分类准确率。

## AI智能功能

### OCR识别流程
1. 图像获取：调用系统相机、相册选择或截图监听
2. 文字识别：Google ML Kit提取文本信息
3. 数据解析：正则表达式匹配关键字段
4. 支付渠道识别：基于关键词识别支付来源
5. 两级分类：结合关键词和AI模型进行分类（仅使用现有分类库）
6. **结果预览**：返回结构化数据供用户确认
7. **用户确认**：用户修改后保存最终结果

### 文本解析流程
1. 文本输入：用户输入自然语言描述
2. AI解析：Qwen模型解析文本内容
3. 信息提取：提取金额、分类、时间、商户等关键信息（仅使用现有分类库）
4. **结果预览**：返回解析结果供用户确认
5. **用户确认**：用户修改后保存最终结果

### 条件性分类创建机制
- AI识别时严格限制在现有分类库范围内
- 仅当用户明确修改分类为新分类时触发自动创建
- 记录分类创建来源（用户手动创建/AI推荐）
- 防止分类库污染，保持系统稳定性

## 部署方案

### Render平台部署
采用Render云平台进行后端服务部署，充分利用其免费套餐资源：
- Web服务部署Spring Boot应用
- 环境变量配置管理
- 自动构建和部署
- 监控和日志服务

## 核心技术特性

### 智能预算管理
实现动态预算计算模型：剩余预算 = 月度预算 - 实际支出 - 待支付预计支出，提供预算预警和进度监控。

### 多维度分析
- 时间维度分析：日周月年消费趋势
- 分类维度分析：支出构成和占比
- 支付渠道分析：各渠道消费分布
- 对比分析：环比同比数据对比

### 数据安全保障
- 传输安全：HTTPS加密通信
- 数据加密：敏感信息加密存储
- 权限控制：用户数据隔离保护
- 隐私保护：最小化数据收集原则


